<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <title>Projekt - Logowanie i Waluty</title>
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 20px auto;
        max-width: 900px;
        background: #f9fafb;
        color: #333;
        display: flex;
        gap: 20px;
        justify-content: center;
      }

      /* Lewy panel z komunikatem i wyloguj */
      #leftPanel {
        flex: 0 0 280px;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: flex-start;
        min-height: 140px;
      }

      #leftPanel #message {
        color: #27ae60;
        font-weight: 700;
        font-size: 1.2rem;
        margin-bottom: 20px;
      }

      #logoutBtn {
        padding: 10px 20px;
        background-color: #e74c3c;
        border: none;
        color: white;
        font-weight: 600;
        font-size: 1rem;
        border-radius: 6px;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }
      #logoutBtn:hover {
        background-color: #c0392b;
      }

      /* Prawy panel z tabelkami kursów i pieska obok siebie */
      #rightPanel {
        flex: 1 1 580px;
        display: flex;
        gap: 20px;
      }

      /* Obie tabele w prawo, po 50% szerokości */
      .tableContainer {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        flex: 1 1 50%;
        display: flex;
        flex-direction: column;
        align-items: stretch;
      }

      /* Tabela kursów walut */
      #exchangeRates table {
        border-collapse: collapse;
        width: 100%;
        max-width: 100%;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        overflow: hidden;
      }
      #exchangeRates th,
      #exchangeRates td {
        border: none;
        padding: 12px 15px;
        text-align: left;
      }
      #exchangeRates thead tr {
        background-color: #3498db;
        color: white;
        font-weight: 600;
      }
      #exchangeRates tbody tr:nth-child(even) {
        background-color: #f2f6fc;
      }
      #exchangeRates tbody tr:hover {
        background-color: #dbeeff;
      }

      /* Sekcja pieska */
      #dogSection {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      #dogSection button {
        width: 100%;
        padding: 10px;
        background-color: #3498db;
        border: none;
        color: white;
        font-weight: 600;
        border-radius: 6px;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }
      #dogSection button:hover {
        background-color: #2980b9;
      }
      #dogImage {
        margin-top: 15px;
        width: 100%;
        border-radius: 8px;
        display: none;
        object-fit: contain;
        max-height: 300px;
      }

      /* Okno logowania mniejsze */
      #authSection {
        flex: 0 0 280px;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
      }
      #authSection label {
        margin-top: 12px;
        font-weight: 600;
      }
      #authSection input {
        margin-top: 6px;
        padding: 10px;
        border: 1.8px solid #ccc;
        border-radius: 6px;
        font-size: 1rem;
        transition: border-color 0.3s ease;
      }
      #authSection input:focus {
        border-color: #3498db;
        outline: none;
        box-shadow: 0 0 8px rgba(52, 152, 219, 0.4);
      }
      #authSection button {
        margin-top: 20px;
        padding: 10px;
        background-color: #3498db;
        border: none;
        color: white;
        font-weight: 600;
        font-size: 1rem;
        border-radius: 6px;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }
      #authSection button:hover {
        background-color: #2980b9;
      }

      /* Komunikaty logowania */
      #authMessage {
        margin-top: 10px;
        color: #27ae60;
        font-weight: 600;
      }
      #authError {
        margin-top: 10px;
        color: #e74c3c;
        font-weight: 600;
      }

      /* Ukrywanie elementów */
      #authSection.hidden,
      #leftPanel.hidden,
      #rightPanel.hidden {
        display: none;
      }

      /* Responsywność */
      @media (max-width: 900px) {
        body {
          flex-direction: column;
          max-width: 600px;
          margin: 20px auto;
        }
        #leftPanel,
        #rightPanel {
          width: 100%;
          max-width: 100%;
          flex: none;
          margin-bottom: 20px;
        }
        #rightPanel {
          flex-direction: column;
        }
        .tableContainer {
          max-width: 100%;
          margin-bottom: 20px;
          flex: none;
        }
      }
    </style>
  </head>
  <body>
    <div id="authSection">
      <h2>Logowanie</h2>
      <label for="login">Login</label>
      <input type="text" id="login" />

      <label for="password">Hasło</label>
      <input type="password" id="password" />

      <button id="loginBtn">Zaloguj</button>

      <div id="authMessage"></div>
      <div id="authError"></div>
    </div>

    <div id="leftPanel" class="hidden">
      <p id="message">Zalogowano pomyślnie!</p>
      <button id="logoutBtn">Wyloguj</button>
    </div>

    <div id="rightPanel" class="hidden">
      <div class="tableContainer" id="exchangeRates">
        <h3>Kursy walut (NBP)</h3>
        <table>
          <thead>
            <tr>
              <th>Waluta</th>
              <th>Kod</th>
              <th>Kurs (PLN)</th>
            </tr>
          </thead>
          <tbody id="exchangeRatesBody"></tbody>
        </table>
      </div>

      <div class="tableContainer" id="dogSection">
        <h3>Obrazek pieska</h3>
        <button id="getDogBtn">Pobierz obrazek pieska</button>
        <img id="dogImage" alt="Obrazek pieska" />
      </div>
    </div>

    <script>
      const loginInput = document.getElementById("login");
      const passwordInput = document.getElementById("password");
      const loginBtn = document.getElementById("loginBtn");
      const authMessage = document.getElementById("authMessage");
      const authError = document.getElementById("authError");

      const authSection = document.getElementById("authSection");
      const leftPanel = document.getElementById("leftPanel");
      const rightPanel = document.getElementById("rightPanel");

      const message = document.getElementById("message");
      const logoutBtn = document.getElementById("logoutBtn");

      const exchangeRatesBody = document.getElementById("exchangeRatesBody");
      const getDogBtn = document.getElementById("getDogBtn");
      const dogImage = document.getElementById("dogImage");

      function updateUIOnAuth() {
        const token = localStorage.getItem("token");
        if (token) {
          // Pokaż lewe i prawe panele
          leftPanel.classList.remove("hidden");
          rightPanel.classList.remove("hidden");
          authSection.classList.add("hidden");

          authMessage.textContent = "";
          authError.textContent = "";
          message.textContent = "Zalogowano pomyślnie!";
          dogImage.style.display = "none";
          fetchExchangeRates();
        } else {
          leftPanel.classList.add("hidden");
          rightPanel.classList.add("hidden");
          authSection.classList.remove("hidden");

          authMessage.textContent = "";
          authError.textContent = "";
          message.textContent = "";
          dogImage.style.display = "none";
          exchangeRatesBody.innerHTML = "";
        }
      }

      loginBtn.addEventListener("click", async () => {
        const login = loginInput.value.trim();
        const password = passwordInput.value;

        if (!login || !password) {
          authError.textContent = "Wprowadź login i hasło.";
          return;
        }

        try {
          const res = await fetch("/api/auth/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username: login, password: password }),
          });

          if (!res.ok) {
            authError.textContent = "Błąd logowania. Sprawdź dane.";
            return;
          }

          const data = await res.json();
          localStorage.setItem("token", data.token);
          updateUIOnAuth();
        } catch (err) {
          authError.textContent = "Błąd połączenia z serwerem.";
        }
      });

      logoutBtn.addEventListener("click", () => {
        localStorage.removeItem("token");
        updateUIOnAuth();
      });

      getDogBtn.addEventListener("click", async () => {
        try {
          const res = await fetch("https://dog.ceo/api/breeds/image/random");
          if (!res.ok) {
            throw new Error("Nie udało się pobrać obrazka pieska.");
          }
          const data = await res.json();
          dogImage.src = data.message;
          dogImage.style.display = "block";
          authError.textContent = "";
        } catch (err) {
          authError.textContent = "Błąd połączenia z serwerem (piesek).";
        }
      });

      async function fetchExchangeRates() {
        try {
          const res = await fetch(
            "https://api.nbp.pl/api/exchangerates/tables/A?format=json"
          );
          if (!res.ok) {
            throw new Error("Nie udało się pobrać kursów.");
          }
          const data = await res.json();
          const rates = data[0].rates;

          // Pokazujemy tylko 5 walut
          const wantedCodes = ["USD", "EUR", "GBP", "JPY", "CZK"];
          const filteredRates = rates.filter((r) =>
            wantedCodes.includes(r.code)
          );

          exchangeRatesBody.innerHTML = filteredRates
            .map(
              (r) =>
                `<tr><td>${r.currency}</td><td>${
                  r.code
                }</td><td>${r.mid.toFixed(4)}</td></tr>`
            )
            .join("");
        } catch (err) {
          exchangeRatesBody.innerHTML =
            "<tr><td colspan='3'>Błąd pobierania kursów</td></tr>";
        }
      }

      // Po załadowaniu strony sprawdzamy, czy już jesteśmy zalogowani
      updateUIOnAuth();
    </script>
  </body>
</html>
